@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@*
    Developer: Alimohamamd Eghbaldar
*@
@{
    ViewData["Title"] = "درج تصویر جدید";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}
<link href="~/AdminTemplate/libs/dropify/dropify.min.css" rel="stylesheet" type="text/css" />

<div class="content">

    <!-- Start Content-->
    <div class="container-fluid">

        <div class="row">
            <div class="col-12">
                <div class="card-box">
                    <h4 class="m-t-0 header-title">اضافه کردن تصویر جدید در گالری</h4>

                    <div class="row">
                        <div class="col-12">
                            <div class="p-2">

                                <div class="form-group row">
                                    <label class="col-sm-2  col-form-label" for="simpleinput">نام تصویر:</label>
                                    <div class="col-sm-10">
                                        <input type="text" id="txtFullname" class="form-control">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-2  col-form-label" for="example-email">توضیحات:</label>
                                <div class="col-sm-10">
                                    <input type="text" id="txtDetail" name="example-email" class="form-control"
                                           placeholder="توضیحات اختیاری تصویر">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-2  col-form-label">گالری:</label>
                                <div class="col-sm-10">
                                    <select class="custom-select" id="CateId" name="Name"
                                            asp-items="@ViewBag.Item">
                                    </select>
                                </div>

                            </div>
                            <div class="dropify-message">
                                <span class="file-icon">

                            </div><div class="dropify-loader"></div><div class="dropify-errors-container">
                                <ul></ul>
                            </div>

                            <input type="file" id="inputFile" class="dropify" data-height="300">

                            <div class="dropify-preview">
                                <span class="dropify-render"></span>
                                <div class="dropify-infos">
                                    <div class="dropify-infos-inner">
                                        <p class="dropify-filename">
                                            <span class="file-icon">

                                            </span> <span class="dropify-filename-inner"></span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button onclick="Add()" class="btn btn-primary">درج تصویر</button>
                </div>

            </div>
            <!-- end row -->

        </div> <!-- end card-box -->
    </div><!-- end col -->
</div>
@section Scripts{
    <script src="~/AdminTemplate/libs/dropify/dropify.min.js"></script>
    <script src="~/AdminTemplate/js/pages/form-fileupload.init.js"></script>
    <script>
        function Add() {

            Swal.fire({
                title: 'درج تصویر!',
                text: 'از درج این تصویر مطمئن هستید؟',
                icon: 'info',
                showCancelButton: true,
                confirmButtonColor: '#000222',
                cancelButtonColor: '#000222',
                confirmButtonText: 'بلی',
                cancelButtonText: 'خیر'
            }).then((result) => {
                if (result.value) {

                    var postData = new FormData();
                    postData.append("Name", $("#txtFullname").val());
                    postData.append("Detail", $("#txtDetail").val());
                    postData.append("IdGalleryCategory", $("#CateId").val());

                    var Images = document.getElementById("inputFile");
                    postData.append("Filename", Images.files[0]);

                    $.ajax({
                        contentType: false,
                        processData: false,
                        type: 'POST',
                        data: postData,
                        url: '/admin/gallery/create',
                        success: function (data) {
                            if (data.isSuccess == true) {
                               Swal.fire('تصویر با موفقیت درج شد');
                               location.reload();
                            }
                        },
                        error: function (request, status, error) {
                            alert('Err:' + request.responseText);
                        }
                    });
                }
            });

        }
    </script>
}